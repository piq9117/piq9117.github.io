<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>piq9117 - Gitea - Restoring Gitea</title>
        <link href="https://fonts.googleapis.com/css?family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=EB+Garamond&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="../css/default.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">piq9117</a>
            </div>
            <nav>
                <a href="../">home</a>
                <a href="../about.html">about</a>
                <a href="../contact.html">contact</a>
            </nav>
        </header>

        <main role="main">
            <h1>Gitea - Restoring Gitea</h1>
            <article>
    <section class="header">
        Posted on February  9, 2020
        
    </section>
    <section>
        <h1 id="create-a-backup">Create a Backup</h1>
<p>To create a backup of the gitea instance, run the following command:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./gitea</span> dump <span class="at">-c</span> /path/to/app.ini</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># In my case app.ini is located in in /opt/gitea/custom/conf/</span></span></code></pre></div>
<p>This will produce a zip file usually in the form
<code class="codeLine">gitea-dump-&lt;some-numbers&gt;.zip</code>. I then store this to my external
hard drive or in my google drive. If you want to version this in git, you need
to have git lfs enabled because this can be a huge file.</p>
<h1 id="restore-the-backup">Restore the Backup</h1>
<p><a href="https://docs.gitea.io/en-us/backup-and-restore/#restore-command-restore">This</a> is the documentation on how to restore from the backup. I
installed my instance this <a href="https://taezos.org/piq9117/gitea-installer.sh">way</a> but even after substituting
all the right directories it didn’t work.</p>
<p>So here’s what I did. First thing I did was I initialized gitea like a new install.
Setting up the database, domain, admin user, etc. Once that’s done I basically
copy-pasted my backup to where my freshly installed gitea resides in my digital
ocean droplet.</p>
<h1 id="the-backup-file">The Backup File</h1>
<p>I unzip the zip file</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> gitea-dump-<span class="op">&lt;</span>some-numbers<span class="op">&gt;</span>.zip <span class="at">-d</span> gitea-dump</span></code></pre></div>
<p>then copy <code class="codeLine">app.ini</code> to <code class="codeLine">/opt/gitea/custom/conf/app.ini</code>. I
didn’t do the sqlite3 restore because it was just giving me a bunch of errors.
So what I did is copy the entire <code class="codeLine">data/</code> directory from my backup and
pasted it in <code class="codeLine">/opt/gitea/</code>. This will overwrite the <code class="codeLine">data/</code>
directory that was generated by the installation.</p>
<p>I unzip the repositories</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> gitea-repo.zip</span></code></pre></div>
<p>then move that to <code class="codeLine">/opt/gitea/</code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> <span class="at">-r</span> gitea-repo/<span class="pp">*</span> /opt/gitea/</span></code></pre></div>
<h2 id="setting-up-ssh">Setting up SSH</h2>
<p>I had to go to the gitea admin web UI in the dashboard tab, and had to <em>run</em>
<strong>Update the ‘.ssh/authorized_keys’ file with Gitea SSH keys. (Not needed for the built-in SSH server.)</strong></p>
<p>This generated <code class="codeLine">.ssh/authorized_keys</code> with the approriate commands.
After this file was generated then I pasted my public ssh key in it.</p>
<p>I was then able to clone using the ssh link.</p>
<h3 id="source">Source</h3>
<p><a href="https://docs.gitea.io/en-us/backup-and-restore/#backup-and-restore" class="uri">https://docs.gitea.io/en-us/backup-and-restore/#backup-and-restore</a></p>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
